<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>My Stocks Dashboard</title>
</head>
<body>

    <h1>My Stocks Dashboard</h1>

    <h2>Inputs</h2>

    <div>
        <label>AlphaVantage API Key:</label>
        <input type="text" name="api-key" id="my-api-key" placeholder="demo" value="demo">
        <br>

        <label>Stock:</label>
        <select id="my-stock-selector">
            <option value="MSFT" selected>Microsoft (MSFT)</option>
            <option value="GOOG">Google (GOOGL)</option>
            <option value="AAPL">Apple (AAPL)</option>
            <option value="TSLA">Tesla (TSLA)</option>
        </select>
        <br>

        <button id="my-submit-btn">Go!</button>
    </div>

    <hr>

    <h2>Outputs</h2>

    <div>
        <p>Selected Stock: <span id="display-stock-symbol">_____________</span></p>
        <p>Latest (Adjusted) Closing Price: <span id="display-latest-closing-price">__________</span></p>
    </div>

    <div id="dataviz-container"></div>

    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script type="text/javascript">

        console.log("TODO: RESPOND TO BUTTON CLICKS AND CAPTURE FORM INPUTS")


        var button = document.getElementById("my-submit-btn")
        var stocksSelect = document.getElementById("my-stock-selector")
        var apiKeyInput = document.getElementById("my-api-key")

        var displaySymbol = document.getElementById("display-stock-symbol")
        var displayLatestClose = document.getElementById("display-latest-closing-price")



        button.addEventListener("click", makeDashboard)


        function makeDashboard(){
            var apiKey = apiKeyInput.value // pass the value from the input, don't hard-code, to keep secret creds safe
            var symbol = stocksSelect.value

            var requestUrl = "https://www.alphavantage.co/query?function=TIME_SERIES_DAILY_ADJUSTED&symbol=" + symbol + "&apikey=" + apiKey
            console.log("REQUEST URL:", requestUrl)

            fetch(requestUrl)
                .then(response => {
                    return response.json()
                })
                .then(data => {
                    console.log("DATA", data) // this is the data you're looking for

                    // GOAL 2: PROCESS THE DATA

                    var tsd = data["Time Series (Daily)"]
                    var dates = Object.keys(tsd) //> ["2020-01-27", "2020-01-24", "2020-01-23", etc.]
                    var allPrices = Object.values(tsd) // [{}, {}, {}]
                    var closingPrices = allPrices.map(obj => obj["5. adjusted close"]) //> [100, 200, 300]
                    var latestClose = closingPrices[0]
                    console.log("DATES:", dates)
                    console.log("CLOSING PRICES:", closingPrices)
                    console.log("LATEST CLOSE:", latestClose)

                    // DISPLAY DATA
                    displaySymbol.innerText = symbol
                    displayLatestClose.innerText = "$" + latestClose

                    // VISUALIZE THE DATA
                    // see: https://plotly.com/javascript/line-charts/
                    var series = {
                        x: dates,
                        y: closingPrices,
                        mode: "lines+markers"
                    }
                    var chartData = [series]
                    var layout = {
                        title: "Daily Closing Prices for Stock: " + symbol,
                        height: 500
                    }
                    Plotly.newPlot("dataviz-container", chartData, layout, {responsive: true})




                })

        }




    </script>
</body>
</html>
